:root{
  --bg1:#0b0b0b; --bg2:#171717; --panel:#141414; --panel2:#1b1b1b; --text:#f5f5f5; --border:#2a2a2a;
  --lbg1:#f2f4f7; --lbg2:#e5e8ee; --lpanel:#ffffffee; --lpanel2:#f7f8fa; --ltext:#0f1115; --lborder:#e3e6eb;
  --acc1:#7c88ff; --acc2:#b17cff; --accent:#9aa4ff; --ring: rgba(154,164,255,.6);
  --sidebar-w: 260px; --rail-w: 60px;
  --inside-bg-dark: rgba(124,136,255,.14);
  --inside-bg-light: rgba(124,136,255,.16);

  /* === Palette “lite” metallizzata === */
  --lite-sheet-top:#ffffff;
  --lite-sheet-btm:#e9eef6;
  --lite-panel-top:#ffffff;
  --lite-panel-btm:#edf1f7;

  /* Larghezze foglio (più strette ~30/35%) */
  --sheet-w: clamp(280px, 36vw, 620px);
  --sheet-w-two: clamp(240px, 32vw, 560px);

  --logo-size: 24px;

  /* Cestino */
  --danger-rgb: 225,105,105;
  --trash-row-h: 42px;

  /* Var per allineamento twisty/dot */
  --twisty-w: 18px;
  --twisty-gap: 8px;
}

#editorA .ql-editor,
#editorB .ql-editor {
  min-height: 300px;
}

/* --- Notion-ish look per Quill --- */
:root {
  --page-max: 740px;
  --text: #1f2328;
  --text-soft: #6b7280;
  --bg: transparent;
}

.theme-dark :root, body.theme-dark {
  --text: #e5e7eb;
  --text-soft: #9ca3af;
}

/* Contenitore editor */
#editorA, #editorB { background: var(--bg); }

/* Togli bordi/box dal container Quill */
#editorA .ql-container, #editorB .ql-container {
  border: none !important;
}

/* Area di scrittura */
#editorA .ql-editor, #editorB .ql-editor {
  max-width: var(--page-max);
  margin: 0 auto;
  padding: 0;                /* niente padding “card” */
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
  font-size: 16px;
  line-height: 1.65;
  color: var(--text);
}

/* Placeholder elegante */
#editorA .ql-editor.ql-blank::before,
#editorB .ql-editor.ql-blank::before {
  left: 0;
  right: 0;
  color: var(--text-soft);
  opacity: .7;
}

/* Heading */
#editorA .ql-editor h1, #editorB .ql-editor h1 {
  font-size: 2rem; line-height: 1.25; margin: 1.1em 0 .4em;
  font-weight: 700;
}
#editorA .ql-editor h2, #editorB .ql-editor h2 {
  font-size: 1.5rem; line-height: 1.3; margin: 1.1em 0 .45em;
  font-weight: 700;
}
#editorA .ql-editor h3, #editorB .ql-editor h3 {
  font-size: 1.25rem; line-height: 1.35; margin: 1em 0 .4em;
  font-weight: 600;
}

/* Paragrafi e spaziatura blocchi */
#editorA .ql-editor p, #editorB .ql-editor p,
#editorA .ql-editor ul, #editorB,
#editorA .ql-editor ol, #editorB .ql-editor ol,
#editorA .ql-editor blockquote, #editorB .ql-editor blockquote {
  margin: .6em 0;
}

#editorA .ql-editor ol, #editorB .ql-editor ol {
  list-style: decimal;
  padding-left: 1.3em;
}
#editorA .ql-editor li + li, #editorB .ql-editor li + li { margin-top: .1em; }

/* Blockquote */
#editorA .ql-editor blockquote, #editorB .ql-editor blockquote {
  border-left: 3px solid rgba(127,127,127,.35);
  margin: .9em 0; padding: .25em .9em;
  color: var(--text-soft);
}

/* Code inline */
#editorA .ql-editor code, #editorB .ql-editor code {
  background: rgba(127,127,127,.12);
  padding: .15em .35em;
  border-radius: 4px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
}

/* Link */
#editorA .ql-editor a, #editorB .ql-editor a {
  color: #2563eb; text-decoration: none; border-bottom: 1px solid rgba(37,99,235,.3);
}
#editorA .ql-editor a:hover, #editorB .ql-editor a:hover {
  border-bottom-color: rgba(37,99,235,.6);
}

/* Tolgo ombre/tooltip vistosi di Bubble se danno fastidio */
.ql-tooltip {
  border: 1px solid rgba(127,127,127,.25) !important;
  backdrop-filter: blur(4px);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:ui-sans-serif,system-ui,-apple-system,Inter,Segoe UI,Roboto,Arial
}
body.theme-dark{background:radial-gradient(1200px 800px at 0% 0%, var(--bg2), var(--bg1)); color:var(--text)}
body.theme-light{background:radial-gradient(1200px 800px at 0% 0%, var(--lbg2), var(--lbg1)); color:var(--ltext)}

/* === Layout base (scroll a pagina, non interno) === */
.app{
  display:grid;
  grid-template-columns:var(--sidebar-w) 1fr;
  grid-template-rows:auto;
  min-height:100vh;
  transition:grid-template-columns .18s ease;
}
body.sidebar-collapsed .app{grid-template-columns:var(--rail-w) 1fr}

/* Sidebar: sticky con footer sempre visibile e lista scorrevole */
.sidebar{
  position:sticky; top:0; height:100vh;
  display:flex; flex-direction:column; min-width:0; overflow:hidden;
  border-right:1px solid var(--border);
  background:linear-gradient(180deg,var(--panel),var(--panel2));
}
body.theme-light .sidebar{
  border-right-color:var(--lborder);
  background:linear-gradient(180deg, var(--lite-panel-top), var(--lite-panel-btm));
}
.sidebar-head{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:12px}
.logo-badge{
  width: var(--logo-size);
  height: var(--logo-size);
  border-radius: 8px;
  display: grid; place-items: center;
  font-weight: 800;
  font-size: calc(var(--logo-size) * .42);
  letter-spacing: .04em;
  color: white;
  background: linear-gradient(135deg,var(--acc1),var(--acc2));
  box-shadow: 0 2px 10px rgba(124,136,255,.28);
}
.icon-btn{border:none;background:transparent;color:inherit;cursor:pointer;padding:6px;border-radius:8px;line-height:1}
.icon-btn:hover{background:rgba(255,255,255,.06)}
body.theme-light .icon-btn:hover{background:rgba(15,17,21,.06)}

/* === Sidebar resizer (solo espansione a destra) === */
#sidebarResizer{
  position:absolute;
  top:0; right:-3px;
  width:6px; height:100%;
  cursor:col-resize;
  background:transparent;
  z-index:5;
}
#sidebarResizer::before{
  content:"";
  position:absolute; inset:0;
  background: currentColor;
  opacity:0; border-radius:3px;
  transition: opacity .12s ease;
}
#sidebarResizer:hover::before{ opacity:.12 }
#sidebarResizer:active::before{ opacity:.22 }
body.sidebar-collapsed #sidebarResizer{ display:none }

/* Rail (sidebar collassata) */
.rail{
  display:none;
  height:100%;
  padding:14px 0;
  align-items:center;
  gap:8px;
  flex-direction:column;
}
body.sidebar-collapsed .rail{display:flex}
body.sidebar-collapsed .sidebar-head{display:none}
.rail .rail-spacer{flex:1}
.rail .rail-btn{
  width:40px;height:40px;
  border:none;background:transparent;color:inherit;
  display:grid;place-items:center;border-radius:10px;cursor:pointer
}
.rail .rail-btn:hover{background:rgba(255,255,255,.06)}
body.theme-light .rail .rail-btn:hover{background:rgba(15,17,21,.06)}
.rail .rail-btn svg{width:18px;height:18px}
.rail .logo-badge{ margin-bottom: 8px; }

body.sidebar-collapsed .sidebar-body{display:none}
body.sidebar-collapsed .sidebar-footer{display:none}

/* Corpo sidebar (espansa) */
.sidebar-body{display:flex;flex-direction:column;gap:12px;min-height:0;padding:12px; flex:1; overflow:hidden;}
.primary-btn{display:block; width:100%; align-items:center; gap:8px; border:1px solid var(--border); border-radius:10px; padding:10px 12px; background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04)); color:inherit; font-weight:700; cursor:pointer; transition:box-shadow .12s ease, filter .12s ease}
.primary-btn-content{display:flex; align-items:center; gap:8px}
.primary-btn svg{width:16px;height:16px}
.primary-btn:hover{filter:brightness(1.12); box-shadow:0 0 0 2px var(--ring) inset}
body.theme-light .primary-btn{border-color:var(--lborder); background:linear-gradient(135deg, #ffffff, #f7f8fa)}

.search-min{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:transparent;color:inherit;font-size:14px}
body.theme-light .search-min{border-color:var(--lborder)}

/* === Label Documents (+) ben visibile === */
.section-label{
  display:flex; align-items:center; justify-content:space-between;
  gap:6px; margin-top:6px; font-size:12px; text-transform:uppercase; letter-spacing:.12em;
}
.section-label > span{ opacity:.85 }

/* Più “bianco/nero” a seconda del tema */
#docsAdd{
  width:24px; height:24px;
  display:grid; place-items:center;
  border:1px solid var(--border);
  border-radius:8px;
  background:transparent; color:inherit;
  opacity:1; cursor:pointer;
}
body.theme-dark #docsAdd{ color:#fff; }
body.theme-light #docsAdd{ color:#0f1115; border-color:var(--lborder); }
#docsAdd:hover{ background:rgba(255,255,255,.12) }
body.theme-light #docsAdd:hover{ background:rgba(15,17,21,.10) }

.doc-list{display:flex;flex-direction:column;gap:2px;overflow:auto; flex:1; min-height:0;}
.doc-row{position:relative}
.doc-item{position:relative;display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px;border-radius:10px;cursor:pointer;border:1px solid transparent}
.doc-item:hover{background:rgba(255,255,255,.06)}
body.theme-dark .doc-item.active-primary{ background: rgba(255,255,255,.14) }
body.theme-dark .doc-item.active-secondary{ background: rgba(255,255,255,.08) }
body.theme-light .doc-item.active-primary{ background: rgba(15,17,21,.10) }
body.theme-light .doc-item.active-secondary{ background: rgba(15,17,21,.06) }
body.theme-light .doc-item:hover{background:rgba(15,17,21,.06)}
.doc-left{display:flex;align-items:center;gap:8px;min-width:0}

/* === Twisty + DOT allineato (sidebar + trash + children) === */
.twisty{
  width:var(--twisty-w); height:var(--twisty-w);
  flex:0 0 var(--twisty-w);
  display:inline-grid; place-items:center;
  box-sizing:border-box;
  opacity:.9;
  border-radius:6px;
}
.twisty:not(:empty){ cursor:pointer; }
body.theme-dark .twisty:not(:empty):hover{ background:rgba(255,255,255,.14) }
body.theme-light .twisty:not(:empty):hover{ background:rgba(15,17,21,.12) }
.twisty:empty{
  pointer-events:none;
  opacity:.7;
}
.twisty:empty::before{
  content:"";
  width:4px; height:4px;
  border-radius:50%;
  background: currentColor;
  display:block;
}

/* Titolo doc */
.doc-title{font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* Azioni doc */
.doc-actions{display:flex;align-items:center;gap:6px}
.doc-actions .icon-btn{
  width:auto; min-width:22px; height:auto; border:none;
  border-radius:8px;
  background:transparent; color:inherit;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size:16px; line-height:1; padding:0 6px;
  opacity:0; transition:opacity .15s ease, background .12s ease, transform .12s ease;
}
.doc-item:hover .doc-actions .icon-btn{ opacity:1; }
.doc-actions .icon-btn:hover{
  background:rgba(255,255,255,.14);
  transform:translateY(-0.5px);
}
body.theme-light .doc-actions .icon-btn:hover{ background:rgba(15,17,21,.12) }
.doc-actions .icon-btn:focus-visible{ outline:none; background:rgba(255,255,255,.14) }
body.theme-light .doc-actions .icon-btn:focus-visible{ background:rgba(15,17,21,.12) }

/* Drag & Drop – solo linea tra elementi; highlight per inside */
.doc-item.drop-before::before,
.doc-item.drop-after::after{
  content:""; position:absolute; left:8px; right:8px; height:2px;
  border-radius:2px; background:var(--accent);
}
.doc-item.drop-before::before{ top:-2px; }
.doc-item.drop-after::after{ bottom:-2px; }
.doc-item.drop-inside{ background:var(--inside-bg-dark); }
body.theme-light .doc-item.drop-inside{ background:var(--inside-bg-light); }

/* ================================================================ */
/*                    TRASH – FLYOUT COMPATTO                       */
/* ================================================================ */
.trash-row{
  display:flex; align-items:center; gap:8px;
  padding:8px; margin-top:8px;
  border-radius:10px; cursor:pointer; user-select:none;
  border:1px solid transparent;
}
.trash-row:hover{ background:rgba(255,255,255,.06) }
body.theme-light .trash-row:hover{ background:rgba(15,17,21,.06) }
.trash-row .count{ display:none }

.trash-flyout{
  position:fixed;
  left: calc(var(--sidebar-w) + 8px);
  top: 80px;
  width: min(340px, 92vw);
  overflow:hidden;
  border:1px solid var(--border);
  border-radius:16px;
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  box-shadow:0 14px 44px rgba(0,0,0,.32);
  display:none;
  z-index:58;
}
body.sidebar-collapsed .trash-flyout{ left: calc(var(--rail-w) + 8px); }
body.theme-light .trash-flyout{
  border-color:var(--lborder);
  background:linear-gradient(135deg, var(--lite-sheet-top), var(--lite-sheet-btm));
  box-shadow:0 20px 44px rgba(20,30,50,.12);
}

.trash-flyout .flyout-body{
  padding:10px;
  display:flex; flex-direction:column; gap:8px;
}

.trash-flyout #trashSearch{
  padding:8px 10px;
  border:1px solid var(--border);
  border-radius:10px;
  background:transparent; color:inherit; font-size:14px;
  width:100%;
}
.trash-flyout #trashSearch:focus,
.trash-flyout #trashSearch:focus-visible{
  outline:none; box-shadow:none;
}
body.theme-light .trash-flyout #trashSearch{ border-color:var(--lborder) }

.trash-flyout #trashSearch::-webkit-search-cancel-button{
  -webkit-appearance:none;
  height:16px; width:16px; cursor:pointer; opacity:.75; margin-right:4px;
  background-repeat:no-repeat; background-position:center; background-size:14px 14px;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'/%3E%3Cline x1='6' y1='6' x2='18' y2='18'/%3E%3C/svg%3E");
}
.trash-flyout #trashSearch::-webkit-search-cancel-button:hover{ opacity:1 }
body.theme-light .trash-flyout #trashSearch::-webkit-search-cancel-button{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%230f1115' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'/%3E%3Cline x1='6' y1='6' x2='18' y2='18'/%3E%3C/svg%3E");
}

.trash-flyout .trash-list{
  height: calc(var(--trash-row-h) * 4);
  overflow:auto;
  display:flex; flex-direction:column; gap:2px;
}

.trash-flyout .trash-item{
  display:flex; align-items:center; gap:var(--twisty-gap);
  padding:8px; border-radius:10px;
  min-height: var(--trash-row-h);
  border:1px solid transparent;
}
body.theme-dark .trash-flyout .trash-item:hover{ background:rgba(255,255,255,.06) }
body.theme-light .trash-flyout .trash-item:hover{ background:rgba(15,17,21,.06) }

.trash-flyout .trash-left{
  display:flex; align-items:center; min-width:0; gap:var(--twisty-gap); flex:1;
  padding-left: var(--indent, 0px);
}

.trash-flyout .trash-title{
  min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  flex:1;
  padding-left:0 !important;
}

.trash-flyout .trash-actions{ display:flex; gap:6px; }
.trash-flyout .trash-actions .icon-btn{ opacity:1; padding:6px; min-width:28px; border-radius:8px; }
.trash-flyout .trash-actions .btn-restore:hover{ background:rgba(255,255,255,.14) }
body.theme-light .trash-flyout .trash-actions .btn-restore:hover{ background:rgba(15,17,21,.12) }
.trash-flyout .trash-actions .btn-del:hover{ background:rgba(var(--danger-rgb), .22) }
body.theme-light .trash-flyout .trash-actions .btn-del:hover{ background:rgba(var(--danger-rgb), .18) }

.trash-flyout .flyout-foot{ padding:6px 10px 10px 10px; }
#trashEmpty{
  display:block; width:100%;
}
#trashEmpty svg{ display:none !important; }
#trashEmpty span{ margin-left:0 !important; }

#trashPanel, .trash-panel, .trash-drawer, .trash-backdrop{ display:none !important; }

/* ================================================================ */
/*                         MAIN / SHEET                             */
/* ================================================================ */
.main{display:grid;grid-template-rows:auto}

/* >>> Foglio: overlay tenue (gradient “infinito” gestito dal body) */
.canvas{
  position:relative;
  padding:48px 24px 32px 24px;
  overflow:visible;
  min-height:100vh;
  display:flex; flex-direction:column;
  background:linear-gradient(135deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
}
body.theme-light .canvas{
  background:linear-gradient(135deg, var(--lite-sheet-top), var(--lite-sheet-btm));
}

/* === Struttura workspace robusta contro overflow verticale === */
.workspace{flex:1; display:flex; min-height:0; gap:8px;}
.page{flex:1 1 0; min-width:0; min-height:0;}
.sheet{
  width: var(--sheet-w);
  max-width: 100%;
  margin:6px auto 48px;
  padding:20px;
  border:none; border-radius:0; box-shadow:none;
  background:transparent;
  display:flex; flex-direction:column;
  min-height:0; /* evita overflow calc/max-height */
}
.two-up .sheet{ width: var(--sheet-w-two); max-width:100%; }

/* Pannello destro “finestra” full-height (sticky) + vignetta */
/* >>> Aumentato in altezza (top più piccolo, max-height maggiore) */
.two-up #paneB .sheet{
  position: sticky;
  top: 6px;                              /* prima 12px */
  max-height: calc(100vh - 12px);        /* prima 100vh - 24px */
  margin: 6px 6px;                       /* prima 12px 8px */
  overflow: auto;
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  border:1px solid var(--border);
  border-radius:14px;
  box-shadow:0 10px 28px rgba(0,0,0,.28);
}
body.theme-light.two-up #paneB .sheet{
  background:linear-gradient(135deg, var(--lite-sheet-top), var(--lite-sheet-btm));
  border-color:var(--lborder);
  box-shadow:0 16px 34px rgba(20,30,50,.12);
}

/* Grip sinistro del pannello destro (divider per resize) */
.panel-grip-left{
  position:absolute; left:-6px; top:0;
  width:12px; height:100%;
  cursor:col-resize; border-radius:6px;
  background:transparent;
}
.panel-grip-left:hover{
  background:rgba(255,255,255,.06);
}
body.theme-light .panel-grip-left:hover{
  background:rgba(15,17,21,.06);
}

/* Divider centrale “vecchio” nascosto */
.resizer{ display:none !important; }

/* Edge old (disattivati per evitare hover duplici) */
.resize-edge{ display:none !important; }

/* Hairline + unico grip centrale (gestiti dal JS) */
.split-hairline{
  position:absolute; top:0; bottom:0; width:1px; background:currentColor; opacity:.12; z-index:24;
}
.split-grip{
  position:absolute; top:25%; height:50%; width:10px;
  cursor:col-resize; z-index:25; background:transparent; border-radius:6px;
}
.split-grip::before,
.split-grip::after{
  content:"";
  position:absolute; top:50%;
  width:0; height:0; transform:translateY(-50%);
  border-top:4px solid transparent; border-bottom:4px solid transparent;
  opacity:.85; pointer-events:none;
}
.split-grip::before{ left:50%; margin-left:-9px; border-right:6px solid currentColor; }
.split-grip::after { left:50%; margin-left:3px;  border-left:6px  solid currentColor; }
.split-grip:hover{ background:rgba(255,255,255,.06) }
body.theme-light .split-grip:hover{ background:rgba(15,17,21,.06) }

/* ================================================================ */
/*  HEADER PANE & TITOLO (MOD PER MULTILINEA STILE NOTION)         */
/* ================================================================ */

/* ⬇️ CAMBIO: flex -> grid, così il titolo (colonna 1) può wrappare,
   mentre le azioni stanno in colonna 2 e non vengono “spin­te” fuori */
.pane-head{
  display:grid;
  grid-template-columns:minmax(0,1fr) auto;
  align-items:flex-start;
  gap:8px;
}
.pane-actions{
  margin-left:0;               /* non serve più spingere con auto */
  display:flex; gap:6px; align-items:center;
}
/* il titolo deve poter restringersi (min-width:0) per far scattare il wrap */
.pane-head > .title-input{ min-width:0; }

/* Titolo: regole compatibili anche quando passeremo a textarea/contenteditable */
.title-input{
  width:100%;
  font-size:28px; font-weight:800;
  border:none; outline:none; background:transparent; color:inherit;
  line-height:1.25;
  white-space:normal;           /* wrappa (vale per textarea/contenteditable) */
  overflow-wrap:anywhere; word-break:break-word;
  display:block;                /* assicura comportamento di box "blocco" */
}

/* ✅ Appena il titolo NON è più <input>:
   - textarea.title-input OPPURE
   - .title-input[contenteditable="true"]
   il wrap è effettivo e segue la larghezza del foglio/divider. */
textarea.title-input,
.title-input[contenteditable="true"]{
  white-space:normal;
  overflow:hidden;              /* niente scrollbar orizzontale */
  resize:none;                  /* niente grip di resize */
}

/* Close B */
#closeB{
  font-size:20px;
  width:32px; height:32px;
  display:grid; place-items:center;
  border-radius:10px;
}

/* ================================================================ */
/*  DIVIDER TOGGLE + CHILDREN (stile “trash-like” + hover neutro)   */
/* ================================================================ */
.divider-ctrl{position:relative;height:12px;margin:8px 0 6px 0}
.divider-ctrl::before{content:"";position:absolute;left:0;right:0;top:50%;height:1px;background:currentColor;opacity:.15;transform:translateY(-50%)}

.divider-btn{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:18px;height:18px;
  border-radius:50%;
  border:1px solid var(--border);
  background:linear-gradient(135deg,rgba(255,255,255,.16),rgba(255,255,255,.06));
  color:inherit;display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  transition: background .15s ease, box-shadow .15s ease, transform .12s ease;
  box-shadow:0 2px 8px rgba(0,0,0,.16);
}
body.theme-light .divider-btn{
  border-color:var(--lborder);
  background:linear-gradient(135deg, var(--lite-panel-top), var(--lite-panel-btm));
  box-shadow:0 2px 10px rgba(20,30,50,.10);
}
.divider-btn.hidden{display:none}
.divider-btn .chev{display:inline-block;transition:transform .18s ease}
.divider-btn[aria-expanded="true"] .chev{transform:rotate(180deg)}
.divider-btn:hover{
  transform:translate(-50%,-50%) scale(.98);
  background:linear-gradient(135deg,rgba(255,255,255,.20),rgba(255,255,255,.08));
  box-shadow:0 4px 14px rgba(0,0,0,.22);
}
body.theme-light .divider-btn:hover{
  background:linear-gradient(135deg, #fff, #f3f5f8);
  box-shadow:0 6px 16px rgba(20,30,50,.12);
}
.divider-btn:focus-visible{
  outline:none;
  box-shadow:0 0 0 2px rgba(255,255,255,.18) inset, 0 4px 14px rgba(0,0,0,.24);
}
body.theme-light .divider-btn:focus-visible{
  box-shadow:0 0 0 2px rgba(15,17,21,.18) inset, 0 6px 16px rgba(20,30,50,.16);
}

/* Pannello contenuti in stile “trash” */
.children-panel{
  display:none;margin:6px 0 12px 0;
  border:1px solid var(--border);
  border-radius:12px;overflow:hidden;
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  box-shadow:0 10px 28px rgba(0,0,0,.28);
}
body.theme-light .children-panel{
  border-color:var(--lborder);
  background:linear-gradient(135deg, var(--lite-sheet-top), var(--lite-sheet-btm));
  box-shadow:0 16px 34px rgba(20,30,50,.12);
}

/* Head + Back */
.children-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 10px;
  background:rgba(255,255,255,.04);
  gap:8px;
}
body.theme-light .children-head{ background:rgba(0,0,0,.04) }

/* Bottone Back a destra dell’header */
.children-back{
  width:28px; height:28px;
  display:grid; place-items:center;
  border:none; border-radius:8px;
  background:transparent; color:inherit;
  cursor:pointer;
}
.children-back:hover{ background:rgba(255,255,255,.10) }
body.theme-light .children-back:hover{ background:rgba(15,17,21,.10) }
.children-back[disabled]{ opacity:.35; pointer-events:none }

/* Lista “trash-like” */
.children-list{
  padding:6px 8px;
  background:transparent;
  display:flex; flex-direction:column; gap:2px;
  max-height: calc(var(--trash-row-h) * 5);
  overflow:auto;
}

/* Righe children */
.children-item{
  display:flex; align-items:center; gap:var(--twisty-gap);
  padding:8px; border-radius:10px;
  border:1px solid transparent;
  cursor:pointer;
}
body.theme-dark .children-item:hover{ background:rgba(255,255,255,.06) }
body.theme-light .children-item:hover{ background:rgba(15,17,21,.06) }

.children-label{
  flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  cursor:pointer;
}

/* Azioni nel pannello */
.children-panel .icon-btn{
  opacity:1; padding:6px; min-width:28px; border-radius:8px;
}
.children-panel .icon-btn:hover{
  background:rgba(255,255,255,.14);
}
body.theme-light .children-panel .icon-btn:hover{
  background:rgba(15,17,21,.12);
}

/* Nascondiamo i vecchi “chip” Figlio/Livello */
.chip{ display:none !important; }

/* ================================================================ */
/*                         EDITOR                                   */
/* ================================================================ */
.editor{flex:none; display:flex; flex-direction:column}
.editable{
  flex:none;
  overflow:visible;              /* scroll a pagina, non interno */
  padding:8px 0;
  min-height:38vh;
  cursor:text;
  /* WRAP robusto: evita “schermo che si rompe” con parole lunghe */
  overflow-wrap:anywhere;
  word-break:break-word;
}

/* Spaziatura a capo consistente */
.editable p{margin:0 0 17px 0; line-height:1.7; min-height:1.25em}

/* Heading con più aria rispetto al testo seguente */
.editable h1{ font-size:1.8rem; line-height:1.25; font-weight:800; letter-spacing:-.01em; margin:18px 0 14px; }
.editable h2{ font-size:1.4rem; line-height:1.35; font-weight:700; margin:16px 0 12px; }
.editable h3{ font-size:1.15rem; line-height:1.45; font-weight:600; margin:14px 0 10px; }

/* Notion-like: niente contorni blu o ombre quando si scrive */
.editable:focus,
.editable:focus-visible,
[contenteditable="true"]:focus,
[contenteditable="true"]:focus-visible{
  outline:none; box-shadow:none;
}

/* Quote, liste, todo base */
.editable blockquote{
  margin:12px 0;
  padding:10px 14px;
  border-left:5px solid #ffffff;           /* barra più spessa e bianca (dark) */
  background:rgba(255,255,255,.04);
  border-radius:6px;
}
body.theme-light .editable blockquote{
  border-left-color:#0f1115;               /* forte contrasto in light */
  background:rgba(15,17,21,.04);
}
/* padding verticale percepito bilanciato */
.editable blockquote > :first-child{ margin-top:0; }
.editable blockquote > :last-child{ margin-bottom:0; }

.editable ul, .editable ol{ padding-left:1.25rem; margin:8px 0; }
.editable li{ margin:6px 0; }

/* Divider (hr) */
.editable hr{
  border:none; height:1px; background:currentColor; opacity:.18; margin:12px 0;
}

/* To-do list con pallino gradient e ✓ */
.editable .todo-list{ list-style:none; padding-left:0; margin:8px 0; }
.editable .todo-list li{ display:flex; gap:10px; align-items:flex-start; margin:6px 0; }
.editable .todo-list input[type="checkbox"]{
  -webkit-appearance:none; appearance:none;
  width:18px; height:18px; border-radius:50%;
  border:1.5px solid currentColor; outline:none;
  background:linear-gradient(135deg, rgba(255,255,255,.04), rgba(255,255,255,.10));
  display:inline-block; position:relative; margin-top:2px; cursor:pointer;
  transition: filter .12s ease, transform .06s ease, background .12s ease, border-color .12s ease;
}
.editable .todo-list input[type="checkbox"]:hover{ filter:brightness(1.08) } /* fix selettore */
.editable .todo-list input[type="checkbox"]:active{ transform:scale(.96) }

body.theme-light .editable .todo-list input[type="checkbox"]{
  background:linear-gradient(135deg, #fff, #f3f5f8);
  border-color: rgba(15,17,21,.55);
}
.editable .todo-list input[type="checkbox"]:checked{
  border-color: transparent;
  background: linear-gradient(135deg, var(--acc1), var(--acc2));
  box-shadow: 0 2px 10px rgba(124,136,255,.28);
}
.editable .todo-list input[type="checkbox"]:checked::after{
  content:"✓";
  position:absolute; inset:0;
  display:grid; place-items:center;
  font-size:12px; font-weight:800; color:#fff;
}
.editable .todo-list li.done > span{ text-decoration:line-through; opacity:.65 }

/* Placeholder editor: appare quando [data-empty="1"] */
.editable[data-empty="1"]{
  position:relative;
}
.editable[data-empty="1"]::before{
  content: attr(data-placeholder);
  position:absolute; left:0; top:8px;
  opacity:.45;
  pointer-events:none;
  font-size:14px;
}

/* Divider sopra le stats interne */
.stats-divider{height:1px; background:currentColor; opacity:.15; margin-bottom:14px}

/* Stats interne (nascoste: c’è lo Stats Dock fisso) */
.stats{font-size:12px; opacity:.65; display:none}

/* Theme toggle */
.toggle{
  background:transparent;
  border:none;
  padding:0;
  cursor:pointer;
  width:40px; height:40px;
  display:grid; place-items:center;
  border-radius:10px;
  color:inherit;
}
.toggle:hover{ background:rgba(255,255,255,.06) }
body.theme-light .toggle:hover{ background:rgba(15,17,21,.06) }
body.theme-dark .sidebar-footer .toggle{ color: var(--text); }
body.theme-light .sidebar-footer .toggle{ color: var(--ltext); }

/* Knob */
.knob{
  width:18px; height:18px;
  border:none;
  background:transparent;
  display:grid; place-items:center;
}
body.theme-light .knob{ border:none }
.knob svg{ width:18px; height:18px; stroke:currentColor }

/* Footer sidebar: sempre visibile in fondo */
.sidebar-footer{
  margin-top:auto;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border-top:1px solid var(--border);
  background:linear-gradient(180deg, transparent, rgba(0,0,0,.06));
}
body.theme-light .sidebar-footer{border-top-color:var(--lborder); background:linear-gradient(180deg, transparent, rgba(0,0,0,.04));}

/* Settings btn */
#settingsBtn{
  width:40px;height:40px;
  display:grid;place-items:center;
  border:none;border-radius:10px;
  background:transparent;color:inherit;cursor:pointer;
}
#settingsBtn svg{ width:18px;height:18px }
#settingsBtn:hover{ background:rgba(255,255,255,.06) }
body.theme-light #settingsBtn:hover{ background:rgba(15,17,21,.06) }

/* Primary buttons override */
.primary-btn { transition: background .12s ease; }
.primary-btn:hover { background: rgba(255,255,255,.14); box-shadow: none; filter: none; }
body.theme-light .primary-btn:hover { background: rgba(0,0,0,.08); box-shadow: none; filter: none; }
.primary-btn:focus, .primary-btn:focus-visible, .primary-btn:active { outline: none; box-shadow: none; }

/* Collapse */
#collapseToggleTop{ display:none !important; }
#searchWrap{ padding-top:0 !important; }
.sidebar-head #collapseToggle{
  width:28px;height:28px;display:grid;place-items:center;border:none;border-radius:8px;background:transparent;color:inherit;cursor:pointer
}
.sidebar-head #collapseToggle svg{ width:18px;height:18px }
.sidebar-head #collapseToggle:hover{ background:rgba(255,255,255,.06) }
body.theme-light .sidebar-head #collapseToggle:hover{ background:rgba(15,17,21,.06) }

/* ================================================================ */
/*                          BREADCRUMBS                             */
/* ================================================================ */
.breadcrumbs{
  position:absolute;
  top:12px; left:12px;
  z-index:2;
  display:flex; align-items:center; gap:6px;
  margin:0; padding:0;
  font-size:12px; line-height:1;
  color: inherit;
}
.crumb{
  border: none; background: transparent; color: inherit;
  padding: 4px 6px; border-radius: 8px; cursor: pointer;
  opacity: .72; transition: background .12s ease, opacity .12s ease;
}
.crumb:hover{ opacity:1; }
body.theme-dark .crumb:hover{ background: rgba(255,255,255,.08); }
body.theme-light .crumb:hover{ background: rgba(15,17,21,.08); }

.crumb-sep{
  opacity:.45; user-select:none; pointer-events:none;
}

.crumb.current{
  opacity:.9; user-select:text; cursor: default;
  padding: 4px 6px; border-radius: 8px;
}

.crumb-back{
  border:none; background:transparent; color:inherit;
  padding:4px 6px; border-radius:8px; cursor:pointer;
  opacity:.72; transition: background .12s ease, opacity .12s ease;
}
.crumb-back:hover{ opacity:1; }
body.theme-dark .crumb-back:hover{ background: rgba(255,255,255,.08); }
body.theme-light .crumb-back:hover{ background: rgba(15,17,21,.08); }

.breadcrumbs .crumb,
.breadcrumbs .crumb.current{
  max-width: 28ch;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

/* ================================================================ */
/*                         STATS DOCK FISSO                         */
/* ================================================================ */
.stats-dock{
  position:fixed;
  left:calc(var(--sidebar-w) + 12px);
  bottom:14px;
  font-size:12px;
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:10px;
  background:linear-gradient(135deg,rgba(255,255,255,.10),rgba(255,255,255,.04));
  box-shadow:0 8px 22px rgba(0,0,0,.22);
  opacity:.92;
  z-index:60;
  pointer-events:none;
  display:flex; align-items:center; gap:10px; white-space:nowrap;
  font-variant-numeric: tabular-nums;
}
body.sidebar-collapsed .stats-dock{
  left:calc(var(--rail-w) + 12px);
}
body.theme-light .stats-dock{
  border-color:var(--lborder);
  background:linear-gradient(135deg, #ffffff, #f7f8fa);
  box-shadow:0 10px 26px rgba(20,30,50,.12);
}

/* ================================================================ */
/*                   SLASH MENU & INLINE TOOLBAR                    */
/* ================================================================ */

/* Slash menu (Shift+7) – opaca */
.slash-menu{
  position:absolute; z-index:80;
  min-width:220px; max-width:320px;
  border:1px solid var(--border);
  border-radius:12px; overflow:hidden;
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  box-shadow:0 14px 44px rgba(0,0,0,.32);
}
body.theme-light .slash-menu{
  border-color:var(--lborder);
  background:linear-gradient(135deg, var(--lite-panel-top), var(--lite-panel-btm));
  box-shadow:0 20px 44px rgba(20,30,50,.12);
}
.slash-menu .group-label{ display:none !important; }
.slash-menu .item{
  display:flex; align-items:center; gap:10px;
  padding:8px 10px; cursor:pointer; border-radius:8px; margin:2px 6px;
}
.slash-menu .item:hover{ background:rgba(255,255,255,.08) }
body.theme-light .slash-menu .item:hover{ background:rgba(15,17,21,.08) }
.slash-menu .icon{ width:18px; height:18px; display:grid; place-items:center; }

/* Inline toolbar – base opaca (niente trasparenze sul testo) */
.inline-toolbar{
  position:absolute; z-index:85;
  display:flex; align-items:center; gap:6px;
  padding:6px; border:1px solid var(--border); border-radius:10px;
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  box-shadow:0 12px 34px rgba(0,0,0,.28);
}
body.theme-light .inline-toolbar{
  border-color:var(--lborder);
  background:linear-gradient(180deg, #ffffff, #f7f8fa);
  box-shadow:0 14px 36px rgba(20,30,50,.12);
}
.inline-toolbar .btn{
  border:none; background:transparent; color:inherit; cursor:pointer;
  padding:6px; border-radius:8px; display:grid; place-items:center;
}
.inline-toolbar .btn:hover{ background:rgba(255,255,255,.12) }
body.theme-light .inline-toolbar .btn:hover{ background:rgba(15,17,21,.10) }

.inline-toolbar .menu{
  position:absolute; top:100%; left:0; margin-top:6px;
  min-width:220px; border:1px solid var(--border); border-radius:10px; overflow:hidden;
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  box-shadow:0 12px 34px rgba(0,0,0,.28);
}
body.theme-light .inline-toolbar .menu{
  border-color:var(--lborder);
  background:linear-gradient(135deg, var(--lite-panel-top), var(--lite-panel-btm));
  box-shadow:0 14px 36px rgba(20,30,50,.12);
}
.inline-toolbar .menu .row{ display:flex; align-items:center; gap:8px; padding:8px 10px; cursor:pointer; }
.inline-toolbar .menu .row:hover{ background:rgba(255,255,255,.08) }
body.theme-light .inline-toolbar .menu .row:hover{ background:rgba(15,17,21,.08) }

/* Colori (text/background) */
.color-grid{ display:grid; grid-template-columns:repeat(9, 18px); gap:8px; padding:8px 10px; }
.color-swatch{
  width:18px; height:18px; border-radius:4px; border:1px solid rgba(0,0,0,.18);
}
.color-swatch.is-text{ display:grid; place-items:center; font-size:12px; border:none; }
/* Assicura che il titolo si comporti come su Notion */
.title-input {
  width: 100%;
  max-width: 100%;
  display: block;
  white-space: normal;  /* Permette di andare a capo */
  word-wrap: break-word;
  overflow-wrap: break-word;
  line-height: 1.3;     /* Migliore leggibilità */
}
/* === Headings: spaziatura coerente + placeholder === */
.editable h1{ font-size:1.8rem; line-height:1.25; font-weight:800; letter-spacing:-.01em; margin:18px 0 14px; }
.editable h2{ font-size:1.4rem; line-height:1.25; font-weight:700; margin:18px 0 14px; }
.editable h3{ font-size:1.15rem; line-height:1.25; font-weight:600; margin:18px 0 14px; }

/* Placeholder per H1/H2/H3 quando vuoti */
.editable h1[data-empty="1"],
.editable h2[data-empty="1"],
.editable h3[data-empty="1"]{ position:relative; }

.editable h1[data-empty="1"]::before,
.editable h2[data-empty="1"]::before,
.editable h3[data-empty="1"]::before{
  content: attr(data-placeholder);
  position:absolute; left:0; top:0;
  opacity:.45; pointer-events:none;
}
/* Spaziatura stile Notion per gli heading */
#editableA h1, #editableB h1 { margin: 1.1em 0 0.35em; }
#editableA h2, #editableB h2 { margin: 1em 0 0.35em; }
#editableA h3, #editableB h3 { margin: 0.9em 0 0.35em; }

/* Placeholder sugli heading vuoti */
[contenteditable] h1[data-empty]::before,
[contenteditable] h2[data-empty]::before,
[contenteditable] h3[data-empty]::before {
  content: attr(data-placeholder);
  opacity: .45;
  pointer-events: none;
}

/* Evita che il caret salti: diamo un minimo di altezza agli H vuoti */
[contenteditable] h1[data-empty],
[contenteditable] h2[data-empty],
[contenteditable] h3[data-empty] {
  min-height: 1.4em;
}
/* === PATCH: Heading placeholders (Notion-like) === */
[contenteditable="true"] h1,
[contenteditable="true"] h2,
[contenteditable="true"] h3 {
  position: relative;
}

[contenteditable="true"] h1[data-empty]::before,
[contenteditable="true"] h2[data-empty]::before,
[contenteditable="true"] h3[data-empty]::before {
  content: attr(data-placeholder);
  position: absolute;
  left: 0;
  top: 0;
  pointer-events: none;
  opacity: 0.5;
  /* opzionale: armonizza lo stile del placeholder */
  font-weight: inherit;
  color: inherit;
}
/* Placeholder Quill (tema Bubble) dritto, non italic e ben allineato */
#editorA .ql-editor.ql-blank::before,
#editorB .ql-editor.ql-blank::before {
  font-style: normal;      /* niente corsivo */
  transform: translateY(1.1em);/* toglie il leggero “salto” in alto */
  top: 0;                  /* aggancia bene alla prima riga */
  opacity: .6;             /* un po' più leggero */
}

#editorA .ql-editor li,
#editorB .ql-editor li {
  padding-left: 0;       /* rimuove indent addizionale sui li */
}

;          /* aumenta/abbassa qui invece di font-size */
  transform-origin: left center;
  display: inline-block;           /* assicura un box per il transform */
  width: 1.2em;                    /* spazio “riservato” al pallino */
  line-height: 1;                  
  font-style: normal;              /* niente italic */
}

/* Placeholder visivo per heading vuoti */
.ql-editor [data-placeholder]::before {
  content: attr(data-placeholder);
  pointer-events: none;
  user-select: none;
  opacity: 0.45;
  font-style: normal;          /* niente italic */
  position: absolute;
  left: 0;
  transform: translateY(0.05em); /* micro allineamento verticale */
}

/* Gli <h1>/<h2>/<h3> di Quill sono <p> con data-header.
   Assicuriamoci che possano ospitare il ::before */
.ql-editor p[data-header] {
  position: relative;
  min-height: 1.4em;
}

/* evita che il contenitore “tagli” il marker */
.ql-editor {
  overflow: visible;
}

.ql-bubble .ql-editor li {
  margin: 0 !important;
}

/* usa SEMPRE lo ::before di Quill, ma con il nostro stile */
.ql-bubble .ql-editor li[data-list="bullet"]::before {
  content: "" !important;
  position: absolute;
  left: 0.28em;                     /* <— sposta il dot a destra/sinistra */
  top: 50%;
  transform: translateY(-50%);
  width: 0.42em;                    /* diametro dot */
  height: 0.42em;
  border-radius: 50%;
  background: currentColor;
  opacity: .95;
}

/* Spegni residui di regole precedenti */
:is(#editorA,#editorB).ql-bubble .ql-editor li[data-list="bullet"]::after{
  content:none !important;
}
/* === BULLET QUILL — BLOCCO UNICO, PULITO === */
/* Vale per #editorA e #editorB con tema "bubble" di Quill */
:is(#editorA,#editorB).ql-bubble .ql-editor ul,
:is(#editorA,#editorB).ql-bubble .ql-editor ol{
  margin:0.8em !important;
  padding-left:0em !important;
  list-style:none !important; /* disattiva marker nativi */
}

:is(#editorA,#editorB).ql-bubble .ql-editor li[data-list]{
  position:relative !important;
  margin:0 !important;
  padding-left:2em !important;   /* distanza testo ↔ dot */
  line-height:1.6 !important;
  overflow:visible !important;
}

:is(#editorA,#editorB).ql-bubble .ql-editor li[data-list="bullet"]::before{
  content:"" !important;
  position:absolute !important;
  left:0em !important;           /* sposta il dot orizzontalmente */
  top:50% !important;
  transform:translateY(-50%) !important;
  width:1.4em !important;          /* diametro dot */
  height:1.4em !important;
  border-radius:50% !important;
  background:currentColor !important;
  opacity:.95 !important;
  margin:0 !important;
}

/* spegne qualsiasi pseudo residuo */
:is(#editorA,#editorB).ql-bubble .ql-editor li[data-list="bullet"]::after{
  content:none !important;
}
/* Placeholder custom per paragrafi */
.ql-editor[data-placeholder]:empty::before {
  content: attr(data-placeholder);
  color: rgba(0,0,0,.45);
  pointer-events: none;
  position: absolute;
  left: 0;
}
